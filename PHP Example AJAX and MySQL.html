<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta content="text/html; charset=utf-8" http-equiv="content-type">
    <title>PHP - AJAX and MySQL</title>
    <style>a.menu_html_intro{font-weight:bold;}</style>
    <meta name="viewport" content="width=device-width">
    <meta name="Keywords" content="HTML,CSS,XML,JavaScript,DOM,jQuery,ASP.NET,PHP,SQL,colors,tutorial,programming,development,training,learning,quiz,primer,lessons,reference,w3-examples,source code,tryphps,tips,color table,w3c,cascading style sheets,active server pages,Web building,Webmaster">
    <meta name="Description" content="Free HTML CSS JavaScript DOM jQuery XML AJAX RSS ASP .NET PHP SQL tutorials, references, examples for web building.">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="http://www.w3schools.com/lib/w3.css">
    <link rel="stylesheet" type="text/css" href="http://www.w3schools.com/stdtheme.css">
    <script>
function showUser(str)
{
if (str=="")
  {
  document.getElementById("txtHint").innerHTML="";
  return;
  }  
if (window.XMLHttpRequest)
  {// code for IE7+, Firefox, Chrome, Opera, Safari
  xmlhttp=new XMLHttpRequest();
  }
else
  {// code for IE6, IE5
  xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
  }
xmlhttp.onreadystatechange=function()
  {
  if (xmlhttp.readyState==4 && xmlhttp.status==200)
    {
    document.getElementById("txtHint").innerHTML=xmlhttp.responseText;
    }
  }
xmlhttp.open("GET","getuser.php?q="+str,true);
xmlhttp.send();
}
</script>
  </head>
  <body>
    <div id="belowTopnav" style="width:auto">
      <div id="page" style="width:auto; padding:30px; margin:10px;">
        <div>
          <div id="main" style="width:auto">
            <h1>PHP - <span class="color_h1">AJAX and MySQL</span></h1>
            <div class="chapter">
              <div class="w3-clear nextprev"> <a class="w3-left w3-btn" href="PHP%20-%20AJAX%20and%20PHP.html">«
                  Previous</a> <a class="w3-right w3-btn" href="PHP%20Example%20AJAX%20and%20XML.html">Next
                  Chapter »</a> </div>
            </div>
            <hr>
            <p class="intro">AJAX 는 데이타베이스와 상호 통신을 하는데 사용될 수 있다.</p>
            <hr>
            <h2>AJAX Database Example</h2>
            <p>다음 예는 웹 페이지가 AJAX로 데이타베이스로부터 정보를 어떻게 가져올 수 있는 지를 보여 줍니다:</p>
            <div class="w3-example">
              <h2 class="example">Example</h2>
              <div class="w3-code notranslate">
                <form action="">
                  <select name="users" onchange="showUser(this.value)">
                    <option value="">Select a person:</option>
                    <option value="1">Peter Griffin</option>
                    <option value="2">Lois Griffin</option>
                    <option value="3">Joseph Swanson</option>
                    <option value="4">Glenn Quagmire</option>
                    <option value="5">Jun Ji</option>
                  </select>
                </form>
                <br>
                <div id="txtHint">Person info will be listed here...</div>
              </div>
              <br>
            </div>
            <br>
            <hr>
            <h2>Example Explained - The MySQL Database</h2>
            <p>위의 예에서 사용하는 데이타베이스 테이블은 다음과 같다:</p>
            <table class="w3-table-all notranslate">
              <tbody>
                <tr>
                  <th>id</th>
                  <th>FirstName</th>
                  <th>LastName</th>
                  <th>Age</th>
                  <th>Hometown</th>
                  <th>Job</th>
                </tr>
                <tr>
                  <td>1</td>
                  <td>Peter</td>
                  <td>Griffin</td>
                  <td>41</td>
                  <td>Quahog</td>
                  <td>Brewery</td>
                </tr>
                <tr>
                  <td>2</td>
                  <td>Lois</td>
                  <td>Griffin</td>
                  <td>40</td>
                  <td>Newport</td>
                  <td>Piano Teacher</td>
                </tr>
                <tr>
                  <td>3</td>
                  <td>Joseph</td>
                  <td>Swanson</td>
                  <td>39</td>
                  <td>Quahog</td>
                  <td>Police Officer</td>
                </tr>
                <tr>
                  <td>4</td>
                  <td>Glenn</td>
                  <td>Quagmire</td>
                  <td>41</td>
                  <td>Quahog</td>
                  <td>Pilot</td>
                </tr>
              </tbody>
            </table>
            <p> </p>
            <p> </p>
            <hr>
            <h2>Example Explained - The HTML Page</h2>
            <p>사용자가 위의 드롭다운(dropdown) 목록에서 사용자를 선택하면, "showUser()"라는 함수가 실행된다.
              함수 는 "onchange" 이벤트에 의해서 트리거 된다. :</p>
            <div class="w3-code notranslate">
              <div> &lt;html&gt;<br>
                &lt;head&gt;<br>
                &lt;script&gt;<br>
                function showUser(str)<br>
                {<br>
                if (str=="")<br>
                &nbsp; {<br>
                &nbsp; document.getElementById("txtHint").innerHTML="";<br>
                &nbsp; return;<br>
                &nbsp; } <br>
                if (window.XMLHttpRequest)<br>
                &nbsp; {// code for IE7+, Firefox, Chrome, Opera, Safari<br>
                &nbsp; xmlhttp=new XMLHttpRequest();<br>
                &nbsp; }<br>
                else<br>
                &nbsp; {// code for IE6, IE5<br>
                &nbsp; xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");<br>
                &nbsp; }<br>
                xmlhttp.onreadystatechange=function()<br>
                &nbsp; {<br>
                &nbsp; if (xmlhttp.readyState==4 &amp;&amp; xmlhttp.status==200)<br>
                &nbsp;&nbsp;&nbsp; {<br>
                &nbsp;&nbsp;&nbsp;
                document.getElementById("txtHint").innerHTML=xmlhttp.responseText;<br>
                &nbsp;&nbsp;&nbsp; }<br>
                &nbsp; }<br>
                xmlhttp.open("GET","getuser.php?q="+str,true);<br>
                xmlhttp.send();<br>
                }<br>
                &lt;/script&gt;<br>
                &lt;/head&gt;<br>
                &lt;body&gt;<br>
                <br>
                &lt;form&gt;<br>
                &lt;select name="users" onchange="showUser(this.value)"&gt;<br>
                &lt;option value=""&gt;Select a person:&lt;/option&gt;<br>
                &lt;option value="1"&gt;Peter Griffin&lt;/option&gt;<br>
                &lt;option value="2"&gt;Lois Griffin&lt;/option&gt;<br>
                &lt;option value="3"&gt;Glenn Quagmire&lt;/option&gt;<br>
                &lt;option value="4"&gt;Joseph Swanson&lt;/option&gt;<br>
                &lt;/select&gt;<br>
                &lt;/form&gt;<br>
                &lt;br&gt;<br>
                &lt;div id="txtHint"&gt;&lt;b&gt;Person info will be listed
                here.&lt;/b&gt;&lt;/div&gt;<br>
                <br>
                &lt;/body&gt;<br>
                &lt;/html&gt; </div>
            </div>
            <p>showUser() 함수는 다음과 같은 작업을 한다.:</p>
            <ul>
              <li>사람이 선택 되어 있는지를 확인</li>
              <li>XMLHttpRequest 객체 생성</li>
              <li>서버 응답이 준비되었을 때 실행될 함수를 생성.</li>
              <li>서버의 파일에 요청을 보내기</li>
              <li>파라메타(q)가 (드롭다운 목록의 내용과 함께) URL에 추가 된 것을 주목하시오</li>
            </ul>
            <hr>
            <h2>Send a Request To a Server</h2>
            <p>서버에 request 를 보내기 위해서, XMLHttpRequest object 의 <strong>open()</strong>
              과 <strong>send()</strong> 메서드를 사용한다 :</p>
            <table class="w3-table-all notranslate">
              <tbody>
                <tr>
                  <th>Method&nbsp;&nbsp;&nbsp; </th>
                  <th>Description</th>
                </tr>
                <tr>
                  <td>open(method,url,async)</td>
                  <td>Specifies the type of request, the URL, and if the request
                    should be handled asynchronously or not.<br>
                    <br>
                    method: the type of request: GET or POST<br>
                    url: the location of the file on the server<br>
                    async: true (asynchronous) or false (synchronous)</td>
                </tr>
                <tr>
                  <td>send(string)</td>
                  <td>Sends the request off to the server.<br>
                    <br>
                    string: Only used for POST requests</td>
                </tr>
              </tbody>
            </table>
            <p> </p>
            <hr>
            <h2>onreadystatechange event</h2>
            <p>request 가 서보로 보내질 때, 우리는 반응(response)에 따라서 어떤 행동을 취하길 원한다. </p>
            <p>onreadystatechange 이벤트는 readyState 가 변할 때 마다 트리거 된다.&nbsp; </p>
            <p>readyState property 는 XMLHttpRequest.의 상태를 담고 있다. </p>
            <p>XMLHttpRequest object의 세가지 중요한 성질은 다음과 같다:</p>
            <table class="w3-table-all notranslate">
              <tbody>
                <tr>
                  <th>iProperty</th>
                  <th>Description</th>
                </tr>
                <tr>
                  <td>onreadystatechange</td>
                  <td>Stores a function (or the name of a function) to be called
                    automatically each time the readyState property changes</td>
                </tr>
                <tr>
                  <td>readyState&nbsp;&nbsp;&nbsp; <br>
                  </td>
                  <td>Holds the status of the XMLHttpRequest. Changes from 0 to
                    4: <br>
                    0: request not initialized <br>
                    1: server connection established<br>
                    2: request received <br>
                    3: processing request <br>
                    4: request finished and response is ready</td>
                </tr>
                <tr>
                  <td>status&nbsp;&nbsp;&nbsp; <br>
                  </td>
                  <td>200: "OK"<br>
                    404: Page not found</td>
                </tr>
              </tbody>
            </table>
            <p> </p>
            <hr>
            <h2>PHP File</h2>
            <p>위의 JavaScript 에 의해서 호출된 서버의 페이지는 "getuser.php" 라는 PHP 파일입니다.</p>
            <p>"getuser.php" 의 소스 코드는 MySQL 데이타베이스에서 쿼리를 실행하고, 그 결과를 HTML 테이블로
              반환한다.:</p>
            <div class="w3-code notranslate">
              <div> &lt;?php<br>
                $q = intval($_GET['q']);<br>
                <br>
                $con = mysqli_connect('localhost','peter','abc123','my_db');<br>
                if (!$con)<br>
                &nbsp;&nbsp;{<br>
                &nbsp;&nbsp;die('Could not connect: ' . mysqli_error($con));<br>
                &nbsp;&nbsp;}<br>
                <br>
                mysqli_select_db($con,"ajax_tryphp");<br>
                $sql="SELECT * FROM user WHERE id = '".$q."'";<br>
                <br>
                $result = mysqli_query($con,$sql);<br>
                <br>
                echo "&lt;table border='1'&gt;<br>
                &lt;tr&gt;<br>
                &lt;th&gt;Firstname&lt;/th&gt;<br>
                &lt;th&gt;Lastname&lt;/th&gt;<br>
                &lt;th&gt;Age&lt;/th&gt;<br>
                &lt;th&gt;Hometown&lt;/th&gt;<br>
                &lt;th&gt;Job&lt;/th&gt;<br>
                &lt;/tr&gt;";<br>
                <br>
                while($row = mysqli_fetch_array($result))<br>
                &nbsp;&nbsp;{<br>
                &nbsp;&nbsp;echo "&lt;tr&gt;";<br>
                &nbsp;&nbsp;echo "&lt;td&gt;" . $row['FirstName'] .
                "&lt;/td&gt;";<br>
                &nbsp;&nbsp;echo "&lt;td&gt;" . $row['LastName'] .
                "&lt;/td&gt;";<br>
                &nbsp;&nbsp;echo "&lt;td&gt;" . $row['Age'] . "&lt;/td&gt;";<br>
                &nbsp;&nbsp;echo "&lt;td&gt;" . $row['Hometown'] .
                "&lt;/td&gt;";<br>
                &nbsp;&nbsp;echo "&lt;td&gt;" . $row['Job'] . "&lt;/td&gt;";<br>
                &nbsp;&nbsp;echo "&lt;/tr&gt;";<br>
                &nbsp;&nbsp;}<br>
                echo "&lt;/table&gt;";<br>
                <br>
                mysqli_close($con);<br>
                ?&gt; </div>
            </div>
            <p>설명: JavaScript 로부터 PHP 파일로 쿼리가 보내지면, 다음과 같은 일이 발생한다:</p>
            <ol>
              <li>PHP 가 MySQL 서버로 연결을 연다.</li>
              <li>정확한 사람을 찾는다.&nbsp;</li>
              <li>HTML 테이블이 생성되고, 데이타로 채워지고, "txtHint" 자리로 다시 보내진다. </li>
            </ol>
            <br>
            <div class="chapter">
              <div class="w3-clear nextprev"> <a class="w3-left w3-btn" href="PHP%20-%20AJAX%20and%20PHP.html">«
                  Previous</a> <a class="w3-right w3-btn" href="PHP%20Example%20AJAX%20and%20XML.html">Next
                  Chapter »</a> </div>
            </div>
            <hr> </div>
        </div>
      </div>
    </div>
  </body>
</html>
